%%{init: {
  'theme': 'dark',
  'themeVariables': {
    'primaryColor': '#1e1e1e',
    'primaryTextColor': '#ffffff',
    'primaryBorderColor': '#ffffff',
    'lineColor': '#ffffff',
    'secondaryColor': '#2d2d2d',
    'tertiaryColor': '#1e1e1e',
    'noteBkgColor': '#2d2d2d',
    'noteTextColor': '#ffffff',
    'noteBorderColor': '#ffffff'
  }
}}%%
graph TB
    subgraph ViewLifecycle["Interactive View Lifecycle"]
        direction TB
        
        Init["Initialize View"]
        Create["Create Components<br/>+ Register Actions"]
        Render["Render<br/>Send/Edit Message"]
        Listen["Listen for Interactions"]
        Collect["Collect Interaction"]
        Ack["Acknowledge"]
        Resolve["Resolve Action"]
        Handle["Handle Action<br/>via ViewHandler"]
        Update["Update State"]
        Stop["Stop / Exit"]
        Timeout["Timeout"]

        Init --> Create
        Create --> Render
        Render --> Listen
        Listen --> Collect
        Collect -->|received| Ack
        Ack --> Resolve
        Resolve --> Handle
        Handle -->|Some action| Update
        Handle -->|None| Stop
        Update --> Create
        Collect -->|timeout| Timeout
        Timeout -->|on_timeout| Render
        Render -.->|final| Stop
    end
    
    subgraph Core["View Core"]
        direction TB
        ViewCore["ViewCore"]
        ViewContext["ViewContext"]
        ActionRegistry["ActionRegistry"]
        
        ViewCore --> ViewContext
        ViewCore --> ActionRegistry
    end
    
    subgraph Traits["View Traits"]
        direction TB
        View["View"]
        ResponseView["ResponseView"]
        InteractiveView["InteractiveView"]
        ViewHandler["ViewHandler"]
        ChildViewResolver["ChildViewResolver"]
        
        View --> ResponseView
        View --> InteractiveView
        InteractiveView --> ViewHandler
        ViewHandler --> ChildViewResolver
    end
    
    subgraph Handler["ViewHandler Trait"]
        direction TB
        VH_Handle["handle(action, interaction)<br/>-> Option~Action~"]
        VH_Timeout["on_timeout()<br/>-> Result"]
        VH_Children["children()<br/>-> Vec~ChildViewResolver~"]
    end
    
    Core -->|powers| ViewLifecycle
    Traits -->|implements| ViewLifecycle
    ViewHandler -.->|defines| VH_Handle
    ViewHandler -.->|defines| VH_Timeout
    ViewHandler -.->|defines| VH_Children
    
    style Init fill:#2d2d2d,stroke:#ffffff,stroke-width:2px
    style Stop fill:#2d2d2d,stroke:#ffffff,stroke-width:2px
    style Create fill:#1e1e1e,stroke:#ffffff
    style Render fill:#1e1e1e,stroke:#ffffff
    style Listen fill:#1e1e1e,stroke:#ffffff
